
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quick Start &#8212; NautilusTrader Docs</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="User Guide" href="../2_user_guide/0_index.html" />
    <link rel="prev" title="Installation" href="1_installation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/nautilus-trader-docs.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="0_index.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../2_user_guide/0_index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../3_api_reference/0_index.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../4_integrations/0_index.html">
  Integrations
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../5_developer_guide/0_index.html">
  Developer Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference external nav-link" href="https://github.com/nautechsystems/nautilus_trader/blob/develop/RELEASES.md">
  Releases
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://nautilustrader.io">nautilustrader.io<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/nautechsystems/nautilus_trader" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search docs..." aria-label="Search docs..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1_installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Quick Start
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-the-sample-data">
   Getting the sample data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#connecting-to-the-datacatalog">
   Connecting to the DataCatalog
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#writing-a-trading-strategy">
   Writing a trading strategy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configuing-backtests">
   Configuing Backtests
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#venue">
   Venue
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#instruments">
   Instruments
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data">
   Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#engine">
   Engine
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#strategies">
   Strategies
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-a-backtest">
   Running a backtest
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="quick-start">
<h1>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h1>
<p>This section explains how to get up and running with NautilusTrader by running some backtests on
FX data. The Nautilus maintainers have pre-loaded some existing data into the Nautilus storage
format (parquet) for this guide.</p>
<p>For more details on how to load other data into Nautilus, see <a class="reference internal" href="../2_user_guide/2_backtest_example.html"><span class="doc std std-doc">Backtest Example</span></a></p>
<div class="section" id="getting-the-sample-data">
<h2>Getting the sample data<a class="headerlink" href="#getting-the-sample-data" title="Permalink to this headline">¶</a></h2>
<p>We have prepared a script to load sample data into the Nautilus format for use with this example.
First, download and load the data by running the next cell (this should take ~ 1-2 mins):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!curl https://raw.githubusercontent.com/nautechsystems/nautilus_data/main/scripts/hist_data_to_catalog.py | python - 
</pre></div>
</div>
</div>
<div class="section" id="connecting-to-the-datacatalog">
<h2>Connecting to the DataCatalog<a class="headerlink" href="#connecting-to-the-datacatalog" title="Permalink to this headline">¶</a></h2>
<p>If everything worked correctly, you should be able to see a single EUR/USD instrument in the catalog:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nautilus_trader.persistence.catalog</span> <span class="kn">import</span> <span class="n">DataCatalog</span>

<span class="n">catalog</span> <span class="o">=</span> <span class="n">DataCatalog</span><span class="p">(</span><span class="s2">&quot;EUDUSD202001/&quot;</span><span class="p">)</span>
<span class="n">catalog</span><span class="o">.</span><span class="n">instruments</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-a-trading-strategy">
<h2>Writing a trading strategy<a class="headerlink" href="#writing-a-trading-strategy" title="Permalink to this headline">¶</a></h2>
<p>NautilusTrader includes a handful of indicators built-in, in this example we will use a MACD indicator to
build a simple trading strategy.
You can read more about <a class="reference external" href="https://www.investopedia.com/terms/m/macd.asp">MACD here</a>, so this
indicator merely serves as an example without any expected alpha. There is also a way of
registering indicators to receive certain data types, however in this example we manually pass the received
<code class="docutils literal notranslate"><span class="pre">QuoteTick</span></code> to the indicator in the <code class="docutils literal notranslate"><span class="pre">on_quote_tick</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nautilus_trader.trading.strategy</span> <span class="kn">import</span> <span class="n">TradingStrategy</span><span class="p">,</span> <span class="n">TradingStrategyConfig</span>
<span class="kn">from</span> <span class="nn">nautilus_trader.indicators.macd</span> <span class="kn">import</span> <span class="n">MovingAverageConvergenceDivergence</span>
<span class="kn">from</span> <span class="nn">nautilus_trader.model.data.tick</span> <span class="kn">import</span> <span class="n">QuoteTick</span>
<span class="kn">from</span> <span class="nn">nautilus_trader.model.enums</span> <span class="kn">import</span> <span class="n">PriceType</span>
<span class="kn">from</span> <span class="nn">nautilus_trader.model.enums</span> <span class="kn">import</span> <span class="n">OrderSide</span>
<span class="kn">from</span> <span class="nn">nautilus_trader.model.events.position</span> <span class="kn">import</span> <span class="n">PositionEvent</span>
<span class="kn">from</span> <span class="nn">nautilus_trader.model.identifiers</span> <span class="kn">import</span> <span class="n">InstrumentId</span>
<span class="kn">from</span> <span class="nn">nautilus_trader.model.objects</span> <span class="kn">import</span> <span class="n">Quantity</span>
<span class="kn">from</span> <span class="nn">nautilus_trader.model.position</span> <span class="kn">import</span> <span class="n">Position</span>



<span class="k">class</span> <span class="nc">MACDConfig</span><span class="p">(</span><span class="n">TradingStrategyConfig</span><span class="p">):</span>
    <span class="n">instrument_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">fast_period</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">slow_period</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">trade_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">entry_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.00010</span>


<span class="k">class</span> <span class="nc">MACDStrategy</span><span class="p">(</span><span class="n">TradingStrategy</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">MACDConfig</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="c1"># Our &quot;trading signal&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macd</span> <span class="o">=</span> <span class="n">MovingAverageConvergenceDivergence</span><span class="p">(</span>
            <span class="n">fast_period</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">fast_period</span><span class="p">,</span> <span class="n">slow_period</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">slow_period</span><span class="p">,</span> <span class="n">price_type</span><span class="o">=</span><span class="n">PriceType</span><span class="o">.</span><span class="n">MID</span>
        <span class="p">)</span>
        <span class="c1"># We copy some config values onto the class to make them easier to reference later on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_threshold</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">entry_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span> <span class="o">=</span> <span class="n">InstrumentId</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trade_size</span> <span class="o">=</span> <span class="n">Quantity</span><span class="o">.</span><span class="n">from_int</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">trade_size</span><span class="p">)</span>

        <span class="c1"># Convenience</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Position</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">on_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe_quote_ticks</span><span class="p">(</span><span class="n">instrument_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_quote_tick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tick</span><span class="p">:</span> <span class="n">QuoteTick</span><span class="p">):</span>
        <span class="c1"># Update our MACD</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macd</span><span class="o">.</span><span class="n">handle_quote_tick</span><span class="p">(</span><span class="n">tick</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">macd</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="c1"># self._log.info(f&quot;{self.macd.value=}:%5d&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_for_entry</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_for_exit</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">quantity</span> <span class="o">&lt;=</span> <span class="mi">1000</span>

    <span class="k">def</span> <span class="nf">on_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">PositionEvent</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">position_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_for_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">positions</span><span class="p">():</span>
            <span class="c1"># If we have a position, do not enter again</span>
            <span class="k">return</span>

        <span class="c1"># We have no position, check if we are above or below our MACD entry threshold</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">macd</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_threshold</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entering trade, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">macd</span><span class="o">.</span><span class="n">value</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">entry_threshold</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># We&#39;re above (to sell) or below (to buy) our entry threshold, with no position: enter a trade</span>
            <span class="n">side</span> <span class="o">=</span> <span class="n">OrderSide</span><span class="o">.</span><span class="n">BUY</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">macd</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">entry_threshold</span> <span class="k">else</span> <span class="n">OrderSide</span><span class="o">.</span><span class="n">SELL</span>
            <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_factory</span><span class="o">.</span><span class="n">market</span><span class="p">(</span>
                <span class="n">instrument_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">,</span>
                <span class="n">order_side</span><span class="o">=</span><span class="n">side</span><span class="p">,</span>
                <span class="n">quantity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trade_size</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">submit_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_for_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">positions</span><span class="p">():</span>
            <span class="c1"># If we don&#39;t have a position, return early</span>
            <span class="k">return</span>

        <span class="c1"># We have a position, check if we have crossed back over the MACD 0 line (and therefore close position)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">is_long</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">macd</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">is_short</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">macd</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exiting trade, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">macd</span><span class="o">.</span><span class="n">value</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># We&#39;ve crossed back over 0 line - close the position.</span>
            <span class="c1"># Opposite to trade entry, except only sell our position size (we may not have been full filled)</span>
            <span class="n">side</span> <span class="o">=</span> <span class="n">OrderSide</span><span class="o">.</span><span class="n">SELL</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">is_long</span> <span class="k">else</span> <span class="n">OrderSide</span><span class="o">.</span><span class="n">BUY</span>
            <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_factory</span><span class="o">.</span><span class="n">market</span><span class="p">(</span>
                <span class="n">instrument_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">,</span>
                <span class="n">order_side</span><span class="o">=</span><span class="n">side</span><span class="p">,</span>
                <span class="n">quantity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">quantity</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">submit_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
</pre></div>
</div>
<!-- #region pycharm={"name": "#%% md\n"} -->
</div>
<div class="section" id="configuing-backtests">
<h2>Configuing Backtests<a class="headerlink" href="#configuing-backtests" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a trading strategy and data, we can run a backtest! Nautilus uses a <code class="docutils literal notranslate"><span class="pre">BacktestEngine</span></code>
to configure and run backtests, and requires some setup. This may seem a little complex at first,
however this is necessary for the correctness that Nautilus strives for.</p>
<p>To configure a <code class="docutils literal notranslate"><span class="pre">BacktestEngine</span></code>, we create an instance of a <code class="docutils literal notranslate"><span class="pre">BacktestRunConfig</span></code>, configuring the
following (minimal) aspects of the backtest:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code> - The input data we would like to perform the backtest on</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">venues</span></code> - The simulated venues (exchanges or brokers) available in the backtest</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">strategies</span></code> - The strategy or strategies we would like to run for the backtest</p></li>
</ul>
<p>There are many more configurable features which will be described later in the docs, for now this will get us up and running.</p>
<!-- #endregion -->
<!-- #region pycharm={"name": "#%% md\n"} -->
</div>
<div class="section" id="venue">
<h2>Venue<a class="headerlink" href="#venue" title="Permalink to this headline">¶</a></h2>
<p>First, we create a venue. For this example we will create a simulated FX ECN venue.
A venue needs a name which acts as an ID, as well as some basic configuration;
the account type (cash vs margin), an optional base currency, and starting balance.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nautilus_trader.backtest.config</span> <span class="kn">import</span> <span class="n">BacktestVenueConfig</span>

<span class="n">venue</span> <span class="o">=</span> <span class="n">BacktestVenueConfig</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;SIM&quot;</span><span class="p">,</span>
    <span class="n">oms_type</span><span class="o">=</span><span class="s1">&#39;NETTING&#39;</span><span class="p">,</span>
    <span class="n">account_type</span><span class="o">=</span><span class="s1">&#39;CASH&#39;</span><span class="p">,</span>
    <span class="n">base_currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">,</span>
    <span class="n">starting_balances</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;100_000 USD&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<!-- #region -->
</div>
<div class="section" id="instruments">
<h2>Instruments<a class="headerlink" href="#instruments" title="Permalink to this headline">¶</a></h2>
<p>Second, we need to know about the instruments that we would like to load data for, we can use the <code class="docutils literal notranslate"><span class="pre">DataCatalog</span></code> for this:</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">instruments</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">instruments</span><span class="p">(</span><span class="n">as_nautilus</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">instruments</span>
</pre></div>
</div>
<!-- #region jupyter={"outputs_hidden": false} pycharm={"name": "#%% md\n"} -->
</div>
<div class="section" id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h2>
<p>Next, we need to configure the data for the backtest. Nautilus is built to be very flexible when it
comes to loading data for backtests, however this also means some configuration is required.</p>
<p>For each tick type (and instrument), we add a <code class="docutils literal notranslate"><span class="pre">BacktestDataConfig</span></code>. In this instance we are simply
adding the <code class="docutils literal notranslate"><span class="pre">QuoteTick</span></code>(s) for our EUR/USD instrument:</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nautilus_trader.model.data.tick</span> <span class="kn">import</span> <span class="n">QuoteTick</span>
<span class="kn">from</span> <span class="nn">nautilus_trader.backtest.config</span> <span class="kn">import</span> <span class="n">BacktestDataConfig</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BacktestDataConfig</span><span class="p">(</span>
        <span class="n">catalog_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">catalog</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
        <span class="n">data_cls_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">QuoteTick</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">QuoteTick</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">instrument_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">instruments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
        <span class="n">end_time</span><span class="o">=</span><span class="s1">&#39;2020-01-05&#39;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<!-- #region pycharm={"name": "#%% md\n"} -->
</div>
<div class="section" id="engine">
<h2>Engine<a class="headerlink" href="#engine" title="Permalink to this headline">¶</a></h2>
<p>Then, we need a <code class="docutils literal notranslate"><span class="pre">BacktestEngineConfig</span></code> which allows configuring the log level and other components,
however is fine to leave with its defaults:</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nautilus_trader.backtest.config</span> <span class="kn">import</span> <span class="n">BacktestEngineConfig</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">BacktestEngineConfig</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span> <span class="c1"># Lower to `INFO` to see more logging about orders, events, etc.</span>
</pre></div>
</div>
</div>
<div class="section" id="strategies">
<h2>Strategies<a class="headerlink" href="#strategies" title="Permalink to this headline">¶</a></h2>
<p>And finally is our actual trading strategy(s):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">macd_config</span> <span class="o">=</span> <span class="n">MACDConfig</span><span class="p">(</span>
    <span class="n">instrument_id</span><span class="o">=</span><span class="n">instruments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">fast_period</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">slow_period</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">macd_strategy</span> <span class="o">=</span> <span class="n">MACDStrategy</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">macd_config</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="running-a-backtest">
<h2>Running a backtest<a class="headerlink" href="#running-a-backtest" title="Permalink to this headline">¶</a></h2>
<p>We can now pass our various config pieces to the <code class="docutils literal notranslate"><span class="pre">BacktestRunConfig</span></code> - this object now contains the
full configuration for our backtest, we are ready to run some backtests!</p>
<p>The <code class="docutils literal notranslate"><span class="pre">BacktestNode</span></code> class <em>actually</em> runs the backtest. The reason for this separation between
configuration and execution is the <code class="docutils literal notranslate"><span class="pre">BacktestNode</span></code> allows running multiple configurations (different
parameters or batches of data), as well as parallelisation via the excellent <a class="reference external" href="https://dask.org/">dask</a> library.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nautilus_trader.backtest.node</span> <span class="kn">import</span> <span class="n">BacktestNode</span>
<span class="kn">from</span> <span class="nn">nautilus_trader.backtest.config</span> <span class="kn">import</span> <span class="n">BacktestRunConfig</span>
<span class="kn">from</span> <span class="nn">nautilus_trader.trading.config</span> <span class="kn">import</span> <span class="n">ImportableStrategyConfig</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">BacktestRunConfig</span><span class="p">(</span>
    <span class="n">venues</span><span class="o">=</span><span class="p">[</span><span class="n">venue</span><span class="p">],</span>
    <span class="n">strategies</span><span class="o">=</span><span class="p">[</span><span class="n">macd_strategy</span><span class="p">],</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">engine</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">BacktestNode</span><span class="p">()</span>

 <span class="c1"># run_sync runs one or many configs synchronously</span>
<span class="p">[</span><span class="n">result</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span>
    <span class="n">run_configs</span><span class="o">=</span><span class="p">[</span><span class="n">config</span><span class="p">],</span> 
    <span class="n">return_engine</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># Return the full BacktestEngine (which contains much more detailed information) rather than the standard `BacktestResult`</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">orders</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">positions</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./1_getting_started"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="1_installation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Installation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../2_user_guide/0_index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">User Guide</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2015-2022 Nautech Systems Pty Ltd.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>